// Soft Melanin MCP - Database Schema
// Using PostgreSQL with Supabase

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// Content Artifacts
// ============================================================================

model ContentArtifact {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Core identifiers
  platform String // linkedin_founder, linkedin_company, substack
  segment  String // overextended_professional, healing_high_achiever, creative_reclaimer

  // Content
  hook String
  body String @db.Text

  // Framework mappings stored as JSON
  tripleS Json // { stop, stay, share }
  soft    Json // { separate, own, filter, thrive }

  // Hashtags and SEO
  hashtags Json  // JSON array
  seoTags  Json? // JSON array (optional, for Substack)

  // Visual generation
  visual Json // { prompt, palette, quoteCardTextOptions }

  // Product mentions
  productMentions Json? // JSON array (optional)

  // Growth optimization
  growth Json // { bestPostingTimes, repurposingIdeas, abVariants }

  // QA validation
  qa Json // { authenticityPass, brandVoicePass, etc. }

  // Generation context
  seedIdea     String? @db.Text
  monthlyTheme String?

  // Indexes for efficient querying
  @@index([platform])
  @@index([segment])
  @@index([createdAt])
}

// ============================================================================
// Generation Sessions
// ============================================================================

model GenerationSession {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  // Input
  seedIdea     String  @db.Text
  monthlyTheme String?
  segments     Json // JSON array of selected segments
  platforms    Json // JSON array of selected platforms

  // Options
  includeProductMentions Boolean @default(false)
  generateABVariants     Boolean @default(false)

  // Output
  artifactIds Json // JSON array of artifact IDs
  success     Boolean
  errors      Json? // JSON array of errors
}

// ============================================================================
// Monthly Themes
// ============================================================================

model MonthlyTheme {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Theme details
  month       Int    // 1-12
  year        Int
  title       String
  description String @db.Text
  keywords    Json // JSON array

  // Active status
  isActive Boolean @default(false)

  @@unique([month, year])
}

// ============================================================================
// Seed Ideas Library
// ============================================================================

model SeedIdea {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  // Content
  idea     String  @db.Text
  category String? // optional categorization
  tags     Json? // JSON array

  // Usage tracking
  usageCount Int       @default(0)
  lastUsedAt DateTime?
}

// ============================================================================
// Hashtag Performance (for optimization)
// ============================================================================

model HashtagPerformance {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  hashtag    String @unique
  category   String // primary, wellness, identity, business
  usageCount Int    @default(0)

  // Performance metrics (to be populated from analytics)
  avgEngagement Float?
  avgReach      Float?
}
